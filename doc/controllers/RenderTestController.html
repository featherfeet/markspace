<!DOCTYPE HTML>
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (11.0.5) on Sun Nov 17 11:05:12 PST 2019 -->
<title>RenderTestController</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="dc.created" content="2019-11-17">
<link rel="stylesheet" type="text/css" href="../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../jquery/jquery-ui.css" title="Style">
<script type="text/javascript" src="../script.js"></script>
<script type="text/javascript" src="../jquery/jszip/dist/jszip.min.js"></script>
<script type="text/javascript" src="../jquery/jszip-utils/dist/jszip-utils.min.js"></script>
<!--[if IE]>
<script type="text/javascript" src="../jquery/jszip-utils/dist/jszip-utils-ie.min.js"></script>
<![endif]-->
<script type="text/javascript" src="../jquery/jquery-3.3.1.js"></script>
<script type="text/javascript" src="../jquery/jquery-migrate-3.0.1.js"></script>
<script type="text/javascript" src="../jquery/jquery-ui.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="RenderTestController";
        }
    }
    catch(err) {
    }
//-->
var pathtoroot = "../";
var useModuleDirectories = true;
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<header role="banner">
<nav role="navigation">
<div class="fixedNav">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a id="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../deprecated-list.html">Deprecated</a></li>
<li><a href="../index-files/index-1.html">Index</a></li>
<li><a href="../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../allclasses.html">All&nbsp;Classes</a></li>
</ul>
<ul class="navListSearch">
<li><label for="search">SEARCH:</label>
<input type="text" id="search" value="search" disabled="disabled">
<input type="reset" id="reset" value="reset" disabled="disabled">
</li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li>Method</li>
</ul>
</div>
<a id="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
</div>
<div class="navPadding">&nbsp;</div>
<script type="text/javascript"><!--
$('.navPadding').css('padding-top', $('.fixedNav').css("height"));
//-->
</script>
</nav>
</header>
<!-- ======== START OF CLASS DATA ======== -->
<main role="main">
<div class="header">
<div class="subTitle"><span class="packageLabelInType">Package</span>&nbsp;<a href="package-summary.html">controllers</a></div>
<h2 title="Class RenderTestController" class="title">Class RenderTestController</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li><a href="Controller.html" title="class in controllers">controllers.Controller</a></li>
<li>
<ul class="inheritance">
<li>controllers.RenderTestController</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<pre>public class <span class="typeNameLabel">RenderTestController</span>
extends <a href="Controller.html" title="class in controllers">Controller</a></pre>
<div class="block">Controller to serve GET requests to the /render_test page.</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<section role="region">
<ul class="blockList">
<li class="blockList"><a id="field.summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="memberSummary">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colSecond" scope="col">Field</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private static java.util.Map&lt;java.lang.String,&#8203;org.apache.pdfbox.rendering.PDFRenderer&gt;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#pdfRendererCache">pdfRendererCache</a></span></code></th>
<td class="colLast">
<div class="block">pdfRendererCache is used to share PDFRenderer objects between multiple controllers and request handlers.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private static java.util.Set&lt;java.lang.String&gt;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#renderersBeingCreated">renderersBeingCreated</a></span></code></th>
<td class="colLast">
<div class="block">renderersBeingCreated is used to indicate which PDFRenderers are in the process of being created.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static spark.Route</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#serveRenderTestPageGet">serveRenderTestPageGet</a></span></code></th>
<td class="colLast">
<div class="block">Serve GET requests to /render_test.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a id="fields.inherited.from.class.controllers.Controller">
<!--   -->
</a>
<h3>Fields inherited from class&nbsp;controllers.<a href="Controller.html" title="class in controllers">Controller</a></h3>
<code><a href="Controller.html#persistentStorage">persistentStorage</a></code></li>
</ul>
</li>
</ul>
</section>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<section role="region">
<ul class="blockList">
<li class="blockList"><a id="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Constructor</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tr class="altColor">
<th class="colConstructorName" scope="row"><code><span class="memberNameLink"><a href="#%3Cinit%3E(storage.PersistentStorage,java.util.Map,java.util.Set)">RenderTestController</a></span>&#8203;(<a href="../storage/PersistentStorage.html" title="class in storage">PersistentStorage</a>&nbsp;persistentStorage,
                    java.util.Map&lt;java.lang.String,&#8203;org.apache.pdfbox.rendering.PDFRenderer&gt;&nbsp;pdfRendererCache,
                    java.util.Set&lt;java.lang.String&gt;&nbsp;renderersBeingCreated)</code></th>
<td class="colLast">
<div class="block">Create a new RenderTestController object.</div>
</td>
</tr>
</table>
</li>
</ul>
</section>
<!-- ========== METHOD SUMMARY =========== -->
<section role="region">
<ul class="blockList">
<li class="blockList"><a id="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<ul class="blockList">
<li class="blockList"><a id="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</section>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<section role="region">
<ul class="blockList">
<li class="blockList"><a id="field.detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a id="pdfRendererCache">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>pdfRendererCache</h4>
<pre>private static&nbsp;java.util.Map&lt;java.lang.String,&#8203;org.apache.pdfbox.rendering.PDFRenderer&gt; pdfRendererCache</pre>
<div class="block">pdfRendererCache is used to share PDFRenderer objects between multiple controllers and request handlers.
 Each PDFRenderer is given a unique key of the format "user_id:test_id:answers" where user_id is the user id of
 the owner of the document being rendered, test_id is the id of the test being rendered, and answers is a boolean
 ("true" or "false") of whether the test should be rendered with or without answers.
 <br>
 Since Jetty runs request handlers concurrently, a client requesting every page of a 50-page PDF to be
 rendered would cause the server to create 50 of the same PDFRenderer object at the same time (since the PDFRenderer
 object only get placed into the cache after a request completes). To avoid this, a global Set of all PDFRenderer
 objects in the process of being created is maintained as renderersBeingCreated. While one request handler is creating a PDFRenderer,
 it puts that PDFRenderer's key into renderersBeingCreated. This causes any other request handlers looking for the same
 PDFRenderer to wait until it appears in the cache, thus reducing the creation of superfluous PDFRenderers.</div>
</li>
</ul>
<a id="renderersBeingCreated">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>renderersBeingCreated</h4>
<pre>private static&nbsp;java.util.Set&lt;java.lang.String&gt; renderersBeingCreated</pre>
<div class="block">renderersBeingCreated is used to indicate which PDFRenderers are in the process of being created. While a PDFRenderer is being created,
 other request handlers that need the same PDFRenderer will busy-wait for the PDFRenderer to appear in the cache
 (so as to avoid creating duplicate PDFRenderers, which are resource-intensive).
 <br>
 Since Jetty runs request handlers concurrently, a client requesting every page of a 50-page PDF to be
 rendered would cause the server to create 50 of the same PDFRenderer object at the same time (since the PDFRenderer
 object only get placed into the cache after a request completes). To avoid this, a global Set of all PDFRenderer
 objects in the process of being created is maintained as renderersBeingCreated. While one request handler is creating a PDFRenderer,
 it puts that PDFRenderer's key into renderersBeingCreated. This causes any other request handlers looking for the same
 PDFRenderer to wait until it appears in the cache, thus reducing the creation of superfluous PDFRenderers.</div>
</li>
</ul>
<a id="serveRenderTestPageGet">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>serveRenderTestPageGet</h4>
<pre>public static&nbsp;spark.Route serveRenderTestPageGet</pre>
<div class="block">Serve GET requests to /render_test. This page either returns the number of pages in a test OR the raw, rendered PNG image data of a page of the test.
 The GET requests must have the following parameters:
 <ul>
     <li>test_id: The id number of the test to render from (a positive integer).</li>
     <li>answers: A true or false value of whether to render the test with or without answers.</li>
     <li>page: The page number of the test to render (a positive integer).</li>
     <li>dpi: The dots-per-inch (resolution) to render at (a positive integer).</li>
     <li>get_number_of_pages: A true or false value. If true, the response sent back to the browser will just be the number of pages in the test requested. If false, the response send back will be the rendered PNG image data of the requested page of the test.</li>
 </ul></div>
</li>
</ul>
</li>
</ul>
</section>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<section role="region">
<ul class="blockList">
<li class="blockList"><a id="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a id="&lt;init&gt;(storage.PersistentStorage,java.util.Map,java.util.Set)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>RenderTestController</h4>
<pre>public&nbsp;RenderTestController&#8203;(<a href="../storage/PersistentStorage.html" title="class in storage">PersistentStorage</a>&nbsp;persistentStorage,
                            java.util.Map&lt;java.lang.String,&#8203;org.apache.pdfbox.rendering.PDFRenderer&gt;&nbsp;pdfRendererCache,
                            java.util.Set&lt;java.lang.String&gt;&nbsp;renderersBeingCreated)</pre>
<div class="block">Create a new RenderTestController object.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>persistentStorage</code> - The PersistentStorage object to use to store permanent data. Shared with all other controllers.</dd>
<dd><code>pdfRendererCache</code> - A cache of PDFRenderer objects shared between all controllers that render PDFs. Each one is keyed by a unique key. See controllers.RenderTestController.pdfRendererCache for more information.</dd>
<dd><code>renderersBeingCreated</code> - A set of all PDFRenderer objects currently in the process of being created. See controllers.RenderTestController.renderersBeingCreated for more information.</dd>
</dl>
</li>
</ul>
</li>
</ul>
</section>
</li>
</ul>
</div>
</div>
</main>
<!-- ========= END OF CLASS DATA ========= -->
<footer role="contentinfo">
<nav role="navigation">
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a id="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../deprecated-list.html">Deprecated</a></li>
<li><a href="../index-files/index-1.html">Index</a></li>
<li><a href="../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../allclasses.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li>Method</li>
</ul>
</div>
<a id="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</nav>
</footer>
</body>
</html>
